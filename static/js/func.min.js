var reversiSetting=new ReversiSetting,reversiSettingBk=reversiSetting,storage=localStorage;function cnvHexToRgb(hexVal){var str=hexVal.toString();if(str.length<6)var hex_3digit=str.match(/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})/),hex_r=hex_3digit[1]+hex_3digit[1],hex_g=hex_3digit[2]+hex_3digit[2],hex_b=hex_3digit[3]+hex_3digit[3];else var hex_6digit=str.match(/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})/),hex_r=hex_6digit[1],hex_g=hex_6digit[2],hex_b=hex_6digit[3];var rgb_r=parseInt(hex_r,16),rgb_g=parseInt(hex_g,16),rgb_b=parseInt(hex_b,16);return rgbObj=new Object,rgbObj.r=rgb_r,rgbObj.g=rgb_g,rgbObj.b=rgb_b,rgbObj}function cnvRgbToHex(r,g,b){var rgb_r=r.toString(10),rgb_g=g.toString(10),rgb_b=b.toString(10),hex_r=parseInt(rgb_r).toString(16),hex_g=parseInt(rgb_g).toString(16),hex_b=parseInt(rgb_b).toString(16),hex;return"#"+(hex_r=hex_r.replace(/(^[0-9a-fA-F]{1}$)/,"0$1"))+(hex_g=hex_g.replace(/(^[0-9a-fA-F]{1}$)/,"0$1"))+(hex_b=hex_b.replace(/(^[0-9a-fA-F]{1}$)/,"0$1"))}function set_menu_ui(){var ele;$("#appMenuModal .appMenuGrp label").each((function(){$(this).removeClass("active")})),ele=$('#mMode input[value="'+Number(reversiSetting.Mode)+'"]').parent().addClass("active"),ele=$('#mType input[value="'+Number(reversiSetting.Type)+'"]').parent().addClass("active"),ele=$('#mPlayer input[value="'+Number(reversiSetting.Player)+'"]').parent().addClass("active"),ele=$('#mAssist input[value="'+Number(reversiSetting.Assist)+'"]').parent().addClass("active"),ele=$('#mGameSpd input[value="'+Number(reversiSetting.GameSpd)+'"]').parent().addClass("active"),ele=$('#mEndAnim input[value="'+Number(reversiSetting.EndAnim)+'"]').parent().addClass("active"),ele=$('#mMasuCntMenu input[value="'+Number(reversiSetting.MasuCntMenu)+'"]').parent().addClass("active"),ele=$('#mTheme input[value="'+reversiSetting.Theme+'"]').parent().addClass("active"),ele=$("#mPlayerColor1 input").attr("value",reversiSetting.PlayerColor1),ele=$("#mPlayerColor1 input").minicolors("value",reversiSetting.PlayerColor1),ele=$("#mPlayerColor2 input").attr("value",reversiSetting.PlayerColor2),ele=$("#mPlayerColor2 input").minicolors("value",reversiSetting.PlayerColor2),ele=$("#mBackGroundColor input").attr("value",reversiSetting.BackGroundColor),ele=$("#mBackGroundColor input").minicolors("value",reversiSetting.BackGroundColor),ele=$("#mBorderColor input").attr("value",reversiSetting.BorderColor),ele=$("#mBorderColor input").minicolors("value",reversiSetting.BorderColor);var oldTheme=reversiSetting.Theme;$('head link[href="./css/theme/'+oldTheme+'/bootstrap.min.css"]').remove();var addEle='<link href="./css/theme/'+reversiSetting.Theme+'/bootstrap.min.css" rel="stylesheet" media="screen">';$("head").append(addEle)}function set_masu_size_squer(){var devHeight=$(window).height(),devWidth=$(window).width(),devOffset=100,masuSize,viewSize;console.log("height : "+devHeight+"px"),console.log("width : "+devWidth+"px"),masuSize=(viewSize=devHeight<devWidth?devHeight-100:devWidth-100)/reversiSetting.MasuCnt,$(".reversi_field").width(Math.ceil(masuSize*reversiSetting.MasuCnt)+1+"px"),$(".reversi_field").height(Math.ceil(masuSize*reversiSetting.MasuCnt)+1+"px"),$(".reversi_field .square-wrapper").each((function(){$(this).css("width",masuSize+"px"),$(this).css("height",masuSize+"px")})),$(".reversi_field .square-wrapper .content").each((function(){$(this).css("line-height",.9*masuSize+"px")}))}function appInit(){$(".reversi_field").empty();for(var i=0;i<reversiSetting.MasuCnt;i++){var row=$('<div class="my_row"></div>');row.addClass("pos_row"+String(i)),$(".reversi_field").append(row);for(var j=0;j<reversiSetting.MasuCnt;j++){var ele=$('<div class="square-wrapper"><div class="spacer"><div class="content"></div></div></div>');ele.addClass("pos_x"+String(j)),ele.addClass("pos_y"+String(i)),ele.attr("data-x",String(j)),ele.attr("data-y",String(i)),ele.css("border-color",reversiSetting.BorderColor),$(".pos_row"+String(i)).append(ele)}}$(".reversi_field").append('<div class="clearfix"></div>'),$(".reversi_field").append('<div class="cur_col_msg"></div>'),$(".reversi_field").append('<div class="cur_sts_msg"></div>'),$(".reversi_field").append('<div class="col-xs-3">&nbsp;</div>'),$(".reversi_field").append('<div class="col-xs-3"><button type="button" class="btn btn-primary btn-sm reset">リセット</button></div>'),$(".reversi_field").append('<div class="col-xs-3"><button type="button" class="btn btn-info btn-sm setting" data-toggle="modal" data-target="#appMenuModal">設定</button></div>'),$(".reversi_field").append('<div class="col-xs-3">&nbsp;</div>'),$(".reversi_field").append('<div class="clearfix"></div>'),drawAll(),set_masu_size_squer()}function drawAll(){$(".reversi_field .square-wrapper").each((function(index,element){var curX=$(this).data("x"),curY;drawSingle($(this).data("y"),curX,REVERSI_STS_NONE,0,"")}))}function viewMsgDlg(title,msg){alert(title+"\n"+msg)}function drawSingle(y,x,sts,bk,text){var tgtEle=$('.reversi_field .square-wrapper[data-x="'+x+'"][data-y="'+y+'"]'),tgtEle2=tgtEle.find(".content");sts==REVERSI_STS_NONE?(tgtEle2.removeClass("stone_white"),tgtEle2.removeClass("stone_black"),tgtEle2.css("background-color","transparent")):sts==REVERSI_STS_BLACK?(tgtEle2.removeClass("stone_white"),tgtEle2.addClass("stone_black"),tgtEle2.css("background-color",reversiSetting.PlayerColor1)):sts==REVERSI_STS_WHITE&&(tgtEle2.addClass("stone_white"),tgtEle2.removeClass("stone_black"),tgtEle2.css("background-color",reversiSetting.PlayerColor2));var bkCol=reversiSetting.BackGroundColor,cnvCol;if(1==bk)tgtEle.removeClass("cell_back_green"),tgtEle.removeClass("cell_back_magenta"),tgtEle.removeClass("cell_back_red"),tgtEle.addClass("cell_back_blue"),(cnvCol=cnvHexToRgb(bkCol)).g-=127,cnvCol.g<0&&(cnvCol.g+=255),cnvCol.b+=255,255<cnvCol.b&&(cnvCol.b-=255),bkCol=cnvRgbToHex(cnvCol.r,cnvCol.g,cnvCol.b);else if(2==bk){var cnvCol;tgtEle.removeClass("cell_back_green"),tgtEle.removeClass("cell_back_magenta"),tgtEle.addClass("cell_back_red"),tgtEle.removeClass("cell_back_blue"),(cnvCol=cnvHexToRgb(bkCol)).r+=255,255<cnvCol.r&&(cnvCol.r-=255),cnvCol.g-=127,cnvCol.g<0&&(cnvCol.g+=255),cnvCol.b-=127,cnvCol.b<0&&(cnvCol.b+=255),bkCol=cnvRgbToHex(cnvCol.r,cnvCol.g,cnvCol.b)}else if(3==bk){var cnvCol;tgtEle.removeClass("cell_back_green"),tgtEle.addClass("cell_back_magenta"),tgtEle.removeClass("cell_back_red"),tgtEle.removeClass("cell_back_blue"),(cnvCol=cnvHexToRgb(bkCol)).r+=255,255<cnvCol.r&&(cnvCol.r-=255),cnvCol.b+=255,255<cnvCol.b&&(cnvCol.b-=255),bkCol=cnvRgbToHex(cnvCol.r,cnvCol.g,cnvCol.b)}else tgtEle.addClass("cell_back_green"),tgtEle.removeClass("cell_back_magenta"),tgtEle.removeClass("cell_back_red"),tgtEle.removeClass("cell_back_blue");tgtEle.css("background-color",bkCol),"0"!=text&&0!=text||(text=""),tgtEle2.text(text)}function curColMsg(text){$(".cur_col_msg").text(text)}function curStsMsg(text){$(".cur_sts_msg").text(text)}$(document).ready((function(){function callbacks(obj){var wait_time=0;Object.keys(obj).forEach((function(key){console.log(obj[key]),"Wait"==obj[key].Function&&(wait_time+=Number(obj[key].Param1)),setTimeout((function(param){"ViewMsgDlg"==param.Function?viewMsgDlg(param.Param1,param.Param2):"DrawSingle"==param.Function?drawSingle(param.Param1,param.Param2,param.Param3,param.Param4,param.Param5):"CurColMsg"==param.Function?curColMsg(param.Param1):"CurStsMsg"==param.Function&&curStsMsg(param.Param1)}),wait_time,obj[key])}))}function setSetting(reversiSetting){var requestObj=$.stringify(reversiSetting);$.ajax({url:"./FrontController",type:"POST",data:{func:"setSetting",para:requestObj},beforeSend:function(xhr){xhr.setRequestHeader("X-CSRF-Token",$('meta[name="csrf-token"]').attr("content"))},xhrFields:{withCredentials:!0}}).done((function(response,textStatus,jqXHR){console.log("done"),console.log(response),callbacks(response.Callbacks.Funcs)})).fail((function(jqXHR,textStatus,errorThrown){console.log("fall")})).always((function(data_or_jqXHR,textStatus,jqXHR_or_errorThrown){}))}function reset(){$.ajax({url:"./FrontController",type:"POST",data:{func:"reset"},beforeSend:function(xhr){xhr.setRequestHeader("X-CSRF-Token",$('meta[name="csrf-token"]').attr("content"))},xhrFields:{withCredentials:!0}}).done((function(response,textStatus,jqXHR){console.log("done"),console.log(response),callbacks(response.Callbacks.Funcs)})).fail((function(jqXHR,textStatus,errorThrown){console.log("fall")})).always((function(data_or_jqXHR,textStatus,jqXHR_or_errorThrown){}))}function reversiPlay(y,x){$.ajax({url:"./FrontController",type:"POST",data:{func:"reversiPlay",y:y,x:x},beforeSend:function(xhr){xhr.setRequestHeader("X-CSRF-Token",$('meta[name="csrf-token"]').attr("content"))},xhrFields:{withCredentials:!0}}).done((function(response,textStatus,jqXHR){console.log("done"),console.log(response),callbacks(response.Callbacks.Funcs)})).fail((function(jqXHR,textStatus,errorThrown){console.log("fall")})).always((function(data_or_jqXHR,textStatus,jqXHR_or_errorThrown){}))}jQuery(".minicolor").each((function(){jQuery(this).minicolors({control:jQuery(this).attr("data-control")||"hue",defaultValue:jQuery(this).attr("data-defaultValue")||"",inline:"true"===jQuery(this).attr("data-inline"),letterCase:jQuery(this).attr("data-letterCase")||"lowercase",opacity:jQuery(this).attr("data-opacity"),position:jQuery(this).attr("data-position")||"bottom left",change:function(hex,opacity){},theme:"bootstrap"})}));var lReversiSetting=storage.getItem("appSetting-go");null!=lReversiSetting?reversiSetting=JSON.parse(lReversiSetting):storage.setItem("appSetting-go",JSON.stringify(reversiSetting)),void 0===reversiSetting.PlayerColor1&&(reversiSetting.PlayerColor1="#000000"),void 0===reversiSetting.PlayerColor2&&(reversiSetting.PlayerColor2="#ffffff"),void 0===reversiSetting.BackGroundColor&&(reversiSetting.BackGroundColor="#00ff00"),void 0===reversiSetting.BorderColor&&(reversiSetting.BorderColor="#000000"),set_menu_ui(),appInit(),setSetting(reversiSetting),$(".reversi_field").on("click",".square-wrapper",(function(){var curX=$(this).data("x"),curY=$(this).data("y");console.log("x = "+curX+",y = "+curY),reversiPlay(curY,curX)})),$(".reversi_field").on("click",".reset",(function(){reset()})),$(".reversi_field").on("click",".setting",(function(){reversiSettingBk=reversiSetting})),$("#appMenuModal").on("click",".btn-primary",(function(){reversiSetting.Mode=Number($("#mMode .active input").val()),reversiSetting.Type=Number($("#mType .active input").val()),reversiSetting.Player=Number($("#mPlayer .active input").val()),reversiSetting.Assist=Number($("#mAssist .active input").val()),reversiSetting.GameSpd=Number($("#mGameSpd .active input").val()),reversiSetting.GameSpd==DEF_GAME_SPD_FAST?(reversiSetting.PlayCpuInterVal=DEF_GAME_SPD_FAST_VAL2,reversiSetting.PlayDrawInterVal=DEF_GAME_SPD_FAST_VAL):reversiSetting.GameSpd==DEF_GAME_SPD_MID?(reversiSetting.PlayCpuInterVal=DEF_GAME_SPD_MID_VAL2,reversiSetting.PlayDrawInterVal=DEF_GAME_SPD_MID_VAL):reversiSetting.GameSpd==DEF_GAME_SPD_SLOW&&(reversiSetting.PlayCpuInterVal=DEF_GAME_SPD_SLOW_VAL2,reversiSetting.PlayDrawInterVal=DEF_GAME_SPD_SLOW_VAL),reversiSetting.EndAnim=Number($("#mEndAnim .active input").val()),reversiSetting.MasuCntMenu=Number($("#mMasuCntMenu .active input").val()),reversiSetting.MasuCntMenu==DEF_MASU_CNT_6?reversiSetting.MasuCnt=DEF_MASU_CNT_6_VAL:reversiSetting.MasuCntMenu==DEF_MASU_CNT_8?reversiSetting.MasuCnt=DEF_MASU_CNT_8_VAL:reversiSetting.MasuCntMenu==DEF_MASU_CNT_10?reversiSetting.MasuCnt=DEF_MASU_CNT_10_VAL:reversiSetting.MasuCntMenu==DEF_MASU_CNT_12?reversiSetting.MasuCnt=DEF_MASU_CNT_12_VAL:reversiSetting.MasuCntMenu==DEF_MASU_CNT_14?reversiSetting.MasuCnt=DEF_MASU_CNT_14_VAL:reversiSetting.MasuCntMenu==DEF_MASU_CNT_16&&(reversiSetting.MasuCnt=DEF_MASU_CNT_16_VAL);var oldTheme=reversiSetting.Theme;reversiSetting.Theme=$("#mTheme .active input").val(),$('head link[href="./css/theme/'+oldTheme+'/bootstrap.min.css"]').remove();var addEle='<link href="./css/theme/'+reversiSetting.Theme+'/bootstrap.min.css" rel="stylesheet" media="screen">';$("head").append(addEle),reversiSetting.PlayerColor1=$("#mPlayerColor1 input").val(),reversiSetting.PlayerColor2=$("#mPlayerColor2 input").val(),reversiSetting.BackGroundColor=$("#mBackGroundColor input").val(),reversiSetting.BorderColor=$("#mBorderColor input").val(),storage.setItem("appSetting",JSON.stringify(reversiSetting)),appInit(),setSetting(reversiSetting),console.log(reversiSetting)})),$("#appMenuModal").on("click",".btn-warning",(function(){reversiSetting=new ReversiSetting,set_menu_ui()})),$("#appMenuModal").on("click",".btn-default",(function(){reversiSetting=reversiSettingBk,set_menu_ui()})),$("#appMenuModal").on("hidden.bs.modal",(function(){console.log("appMenuModal close")}));var rs_timer=!1;$(window).resize((function(){!1!==rs_timer&&clearTimeout(rs_timer),rs_timer=setTimeout((function(){set_masu_size_squer()}),200)}))})),$(window).load((function(){set_masu_size_squer()}));