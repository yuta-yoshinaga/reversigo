var reversiSetting=new ReversiSetting,reversiSettingBk=reversiSetting,storage=localStorage;function cnvHexToRgb(e){var t=e.toString();if(t.length<6)var r=t.match(/^#([0-9a-fA-F]{1})([0-9a-fA-F]{1})([0-9a-fA-F]{1})/),a=r[1]+r[1],n=r[2]+r[2],i=r[3]+r[3];else{var s=t.match(/^#([0-9a-fA-F]{2})([0-9a-fA-F]{2})([0-9a-fA-F]{2})/);a=s[1],n=s[2],i=s[3]}var o=parseInt(a,16),l=parseInt(n,16),c=parseInt(i,16);return rgbObj=new Object,rgbObj.r=o,rgbObj.g=l,rgbObj.b=c,rgbObj}function cnvRgbToHex(e,t,r){var a=e.toString(10),n=t.toString(10),i=r.toString(10),s=parseInt(a).toString(16),o=parseInt(n).toString(16),l=parseInt(i).toString(16);return"#"+(s=s.replace(/(^[0-9a-fA-F]{1}$)/,"0$1"))+(o=o.replace(/(^[0-9a-fA-F]{1}$)/,"0$1"))+(l=l.replace(/(^[0-9a-fA-F]{1}$)/,"0$1"))}function set_menu_ui(){$("#appMenuModal .appMenuGrp label").each(function(){$(this).removeClass("active")}),$('#mMode input[value="'+Number(reversiSetting.mMode)+'"]').parent().addClass("active"),$('#mType input[value="'+Number(reversiSetting.mType)+'"]').parent().addClass("active"),$('#mPlayer input[value="'+Number(reversiSetting.mPlayer)+'"]').parent().addClass("active"),$('#mAssist input[value="'+Number(reversiSetting.mAssist)+'"]').parent().addClass("active"),$('#mGameSpd input[value="'+Number(reversiSetting.mGameSpd)+'"]').parent().addClass("active"),$('#mEndAnim input[value="'+Number(reversiSetting.mEndAnim)+'"]').parent().addClass("active"),$('#mMasuCntMenu input[value="'+Number(reversiSetting.mMasuCntMenu)+'"]').parent().addClass("active"),$('#mTheme input[value="'+reversiSetting.mTheme+'"]').parent().addClass("active"),$("#mPlayerColor1 input").attr("value",reversiSetting.mPlayerColor1),$("#mPlayerColor1 input").minicolors("value",reversiSetting.mPlayerColor1),$("#mPlayerColor2 input").attr("value",reversiSetting.mPlayerColor2),$("#mPlayerColor2 input").minicolors("value",reversiSetting.mPlayerColor2),$("#mBackGroundColor input").attr("value",reversiSetting.mBackGroundColor),$("#mBackGroundColor input").minicolors("value",reversiSetting.mBackGroundColor),$("#mBorderColor input").attr("value",reversiSetting.mBorderColor),$("#mBorderColor input").minicolors("value",reversiSetting.mBorderColor);var e=reversiSetting.mTheme;$('head link[href="./css/theme/'+e+'/bootstrap.min.css"]').remove();var t='<link href="./css/theme/'+reversiSetting.mTheme+'/bootstrap.min.css" rel="stylesheet" media="screen">';$("head").append(t)}function set_masu_size_squer(){var e,t=$(window).height(),r=$(window).width();console.log("height : "+t+"px"),console.log("width : "+r+"px"),e=(t<r?t-100:r-100)/reversiSetting.mMasuCnt,$(".reversi_field").width(Math.ceil(e*reversiSetting.mMasuCnt)+1+"px"),$(".reversi_field").height(Math.ceil(e*reversiSetting.mMasuCnt)+1+"px"),$(".reversi_field .square-wrapper").each(function(){$(this).css("width",e+"px"),$(this).css("height",e+"px")}),$(".reversi_field .square-wrapper .content").each(function(){$(this).css("line-height",.9*e+"px")})}function appInit(){$(".reversi_field").empty();for(var e=0;e<reversiSetting.mMasuCnt;e++){var t=$('<div class="my_row"></div>');t.addClass("pos_row"+String(e)),$(".reversi_field").append(t);for(var r=0;r<reversiSetting.mMasuCnt;r++){var a=$('<div class="square-wrapper"><div class="spacer"><div class="content"></div></div></div>');a.addClass("pos_x"+String(r)),a.addClass("pos_y"+String(e)),a.attr("data-x",String(r)),a.attr("data-y",String(e)),a.css("border-color",reversiSetting.mBorderColor),$(".pos_row"+String(e)).append(a)}}$(".reversi_field").append('<div class="clearfix"></div>'),$(".reversi_field").append('<div class="cur_col_msg"></div>'),$(".reversi_field").append('<div class="cur_sts_msg"></div>'),$(".reversi_field").append('<div class="col-xs-3">&nbsp;</div>'),$(".reversi_field").append('<div class="col-xs-3"><button type="button" class="btn btn-primary btn-sm reset">リセット</button></div>'),$(".reversi_field").append('<div class="col-xs-3"><button type="button" class="btn btn-info btn-sm setting" data-toggle="modal" data-target="#appMenuModal">設定</button></div>'),$(".reversi_field").append('<div class="col-xs-3">&nbsp;</div>'),$(".reversi_field").append('<div class="clearfix"></div>'),drawAll(),set_masu_size_squer()}function drawAll(){$(".reversi_field .square-wrapper").each(function(e,t){var r=$(this).data("x");drawSingle($(this).data("y"),r,REVERSI_STS_NONE,0,"")})}function viewMsgDlg(e,t){alert(e+"\n"+t)}function drawSingle(e,t,r,a,n){var i=$('.reversi_field .square-wrapper[data-x="'+t+'"][data-y="'+e+'"]'),s=i.find(".content");r==REVERSI_STS_NONE?(s.removeClass("stone_white"),s.removeClass("stone_black"),s.css("background-color","transparent")):r==REVERSI_STS_BLACK?(s.removeClass("stone_white"),s.addClass("stone_black"),s.css("background-color",reversiSetting.mPlayerColor1)):r==REVERSI_STS_WHITE&&(s.addClass("stone_white"),s.removeClass("stone_black"),s.css("background-color",reversiSetting.mPlayerColor2));var o=reversiSetting.mBackGroundColor;if(1==a)i.removeClass("cell_back_green"),i.removeClass("cell_back_magenta"),i.removeClass("cell_back_red"),i.addClass("cell_back_blue"),(l=cnvHexToRgb(o)).g-=127,l.g<0&&(l.g+=255),l.b+=255,255<l.b&&(l.b-=255),o=cnvRgbToHex(l.r,l.g,l.b);else if(2==a){i.removeClass("cell_back_green"),i.removeClass("cell_back_magenta"),i.addClass("cell_back_red"),i.removeClass("cell_back_blue"),(l=cnvHexToRgb(o)).r+=255,255<l.r&&(l.r-=255),l.g-=127,l.g<0&&(l.g+=255),l.b-=127,l.b<0&&(l.b+=255),o=cnvRgbToHex(l.r,l.g,l.b)}else if(3==a){var l;i.removeClass("cell_back_green"),i.addClass("cell_back_magenta"),i.removeClass("cell_back_red"),i.removeClass("cell_back_blue"),(l=cnvHexToRgb(o)).r+=255,255<l.r&&(l.r-=255),l.b+=255,255<l.b&&(l.b-=255),o=cnvRgbToHex(l.r,l.g,l.b)}else i.addClass("cell_back_green"),i.removeClass("cell_back_magenta"),i.removeClass("cell_back_red"),i.removeClass("cell_back_blue");i.css("background-color",o),"0"!=n&&0!=n||(n=""),s.text(n)}function curColMsg(e){$(".cur_col_msg").text(e)}function curStsMsg(e){$(".cur_sts_msg").text(e)}$(document).ready(function(){function e(e){var t=0;Object.keys(e).forEach(function(r){console.log(e[r]),"Wait"==e[r].func&&(t+=Number(e[r].param1)),setTimeout(function(e){"ViewMsgDlg"==e.func?viewMsgDlg(e.param1,e.param2):"DrawSingle"==e.func?drawSingle(e.param1,e.param2,e.param3,e.param4,e.param5):"CurColMsg"==e.func?curColMsg(e.param1):"CurStsMsg"==e.func&&curStsMsg(e.param1)},t,e[r])})}function t(t){var r=$.stringify(t);$.ajax({url:"./FrontController",type:"POST",data:{func:"setSetting",para:r},beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$('meta[name="csrf-token"]').attr("content"))},xhrFields:{withCredentials:!0}}).done(function(t,r,a){console.log("done"),console.log(t),e(t.callbacks.funcs)}).fail(function(e,t,r){console.log("fall")}).always(function(e,t,r){})}function r(){$.ajax({url:"./FrontController",type:"POST",data:{func:"reset"},beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$('meta[name="csrf-token"]').attr("content"))},xhrFields:{withCredentials:!0}}).done(function(t,r,a){console.log("done"),console.log(t),e(t.callbacks.funcs)}).fail(function(e,t,r){console.log("fall")}).always(function(e,t,r){})}jQuery(".minicolor").each(function(){jQuery(this).minicolors({control:jQuery(this).attr("data-control")||"hue",defaultValue:jQuery(this).attr("data-defaultValue")||"",inline:"true"===jQuery(this).attr("data-inline"),letterCase:jQuery(this).attr("data-letterCase")||"lowercase",opacity:jQuery(this).attr("data-opacity"),position:jQuery(this).attr("data-position")||"bottom left",change:function(e,t){},theme:"bootstrap"})});var a=storage.getItem("appSetting");null!=a?reversiSetting=JSON.parse(a):storage.setItem("appSetting",JSON.stringify(reversiSetting)),void 0===reversiSetting.mPlayerColor1&&(reversiSetting.mPlayerColor1="#000000"),void 0===reversiSetting.mPlayerColor2&&(reversiSetting.mPlayerColor2="#ffffff"),void 0===reversiSetting.mBackGroundColor&&(reversiSetting.mBackGroundColor="#00ff00"),void 0===reversiSetting.mBorderColor&&(reversiSetting.mBorderColor="#000000"),set_menu_ui(),appInit(),t(reversiSetting),$(".reversi_field").on("click",".square-wrapper",function(){var t,r,a=$(this).data("x"),n=$(this).data("y");console.log("x = "+a+",y = "+n),t=n,r=a,$.ajax({url:"./FrontController",type:"POST",data:{func:"reversiPlay",y:t,x:r},beforeSend:function(e){e.setRequestHeader("X-CSRF-Token",$('meta[name="csrf-token"]').attr("content"))},xhrFields:{withCredentials:!0}}).done(function(t,r,a){console.log("done"),console.log(t),e(t.callbacks.funcs)}).fail(function(e,t,r){console.log("fall")}).always(function(e,t,r){})}),$(".reversi_field").on("click",".reset",function(){r()}),$(".reversi_field").on("click",".setting",function(){reversiSettingBk=reversiSetting}),$("#appMenuModal").on("click",".btn-primary",function(){reversiSetting.mMode=$("#mMode .active input").val(),reversiSetting.mType=$("#mType .active input").val(),reversiSetting.mPlayer=$("#mPlayer .active input").val(),reversiSetting.mAssist=$("#mAssist .active input").val(),reversiSetting.mGameSpd=$("#mGameSpd .active input").val(),reversiSetting.mGameSpd==DEF_GAME_SPD_FAST?(reversiSetting.mPlayCpuInterVal=DEF_GAME_SPD_FAST_VAL2,reversiSetting.mPlayDrawInterVal=DEF_GAME_SPD_FAST_VAL):reversiSetting.mGameSpd==DEF_GAME_SPD_MID?(reversiSetting.mPlayCpuInterVal=DEF_GAME_SPD_MID_VAL2,reversiSetting.mPlayDrawInterVal=DEF_GAME_SPD_MID_VAL):reversiSetting.mGameSpd==DEF_GAME_SPD_SLOW&&(reversiSetting.mPlayCpuInterVal=DEF_GAME_SPD_SLOW_VAL2,reversiSetting.mPlayDrawInterVal=DEF_GAME_SPD_SLOW_VAL),reversiSetting.mEndAnim=$("#mEndAnim .active input").val(),reversiSetting.mMasuCntMenu=$("#mMasuCntMenu .active input").val(),reversiSetting.mMasuCntMenu==DEF_MASU_CNT_6?reversiSetting.mMasuCnt=DEF_MASU_CNT_6_VAL:reversiSetting.mMasuCntMenu==DEF_MASU_CNT_8?reversiSetting.mMasuCnt=DEF_MASU_CNT_8_VAL:reversiSetting.mMasuCntMenu==DEF_MASU_CNT_10?reversiSetting.mMasuCnt=DEF_MASU_CNT_10_VAL:reversiSetting.mMasuCntMenu==DEF_MASU_CNT_12?reversiSetting.mMasuCnt=DEF_MASU_CNT_12_VAL:reversiSetting.mMasuCntMenu==DEF_MASU_CNT_14?reversiSetting.mMasuCnt=DEF_MASU_CNT_14_VAL:reversiSetting.mMasuCntMenu==DEF_MASU_CNT_16&&(reversiSetting.mMasuCnt=DEF_MASU_CNT_16_VAL);var e=reversiSetting.mTheme;reversiSetting.mTheme=$("#mTheme .active input").val(),$('head link[href="./css/theme/'+e+'/bootstrap.min.css"]').remove();var a='<link href="./css/theme/'+reversiSetting.mTheme+'/bootstrap.min.css" rel="stylesheet" media="screen">';$("head").append(a),reversiSetting.mPlayerColor1=$("#mPlayerColor1 input").val(),reversiSetting.mPlayerColor2=$("#mPlayerColor2 input").val(),reversiSetting.mBackGroundColor=$("#mBackGroundColor input").val(),reversiSetting.mBorderColor=$("#mBorderColor input").val(),storage.setItem("appSetting",JSON.stringify(reversiSetting)),appInit(),t(reversiSetting),r(),console.log(reversiSetting)}),$("#appMenuModal").on("click",".btn-warning",function(){reversiSetting=new ReversiSetting,set_menu_ui()}),$("#appMenuModal").on("click",".btn-default",function(){reversiSetting=reversiSettingBk,set_menu_ui()}),$("#appMenuModal").on("hidden.bs.modal",function(){console.log("appMenuModal close")});var n=!1;$(window).resize(function(){!1!==n&&clearTimeout(n),n=setTimeout(function(){set_masu_size_squer()},200)})}),$(window).load(function(){set_masu_size_squer()});